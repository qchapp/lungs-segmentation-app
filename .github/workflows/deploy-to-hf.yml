name: Auto deploy to Hugging Face Space (qchapp/3d-lungs-segmentation)

on:
  push:
    branches: [ master, main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          lfs: true

      - name: Generate Hugging Face README with YAML frontmatter (no commit)
        run: |
          set -euo pipefail

          tmp="$(mktemp)"
          cat > "$tmp" <<'EOF'
          ---
          title: Lungs Segmentation Web App
          emoji: ðŸ–¥ï¸
          colorFrom: indigo
          colorTo: green
          sdk: gradio
          sdk_version: 5.49.1
          app_file: app.py
          pinned: false
          ---

          EOF

          cat README.md >> "$tmp"
          mv "$tmp" README.md

      - name: Deploy to HF Space (skip png)
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          pip install -U "huggingface_hub[cli]"
          huggingface-cli login --token "$HF_TOKEN"
          huggingface-cli upload qchapp/3d-lungs-segmentation . \
            --repo-type space \
            --exclude "*.png" \
            --exclude "images/*.png" \
            --exclude ".git/*" \
            --exclude ".github/*"